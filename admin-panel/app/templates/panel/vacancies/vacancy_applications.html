{% extends "panel/base.html" %}

{% block title %}
–†—É–¥–Ω–µ–≤–æ - –ó–∞—è–≤–∫–∏ –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é "{{ vacancy.title }}"
{% endblock %}

{% block styles %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/panel/vacancies/vacancy_applications.css') }}">
{% endblock %}

{% block container %}
<div class="applications-header">
    <div class="header-info">
        <h1>–ó–∞—è–≤–∫–∏ –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é</h1>
        <h2>"{{ vacancy.title }}"</h2>
        <div class="vacancy-meta">
            <span class="meta-item">{{ vacancy.direction }} ‚Ä¢ {{ vacancy.speciality }}</span>
            <span class="meta-item">{{ vacancy.work_format }}</span>
            <span class="meta-item">{{ vacancy.start }} - {{ vacancy.end }}</span>
        </div>
    </div>
    <a href="{{ url_for('panel.vacancies_list') }}" class="btn-back">‚Üê –ù–∞–∑–∞–¥ –∫ –≤–∞–∫–∞–Ω—Å–∏—è–º</a>
</div>

<div class="applications-container">
    <div class="applications-tabs">
        <div class="tab-header">
            <div class="tab-item active" data-tab="new">
                –ù–æ–≤—ã–µ <span class="tab-count">{{ students_by_status.new|length }}</span>
            </div>
            <div class="tab-item" data-tab="in_review">
                –í —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏ <span class="tab-count">{{ students_by_status.in_review|length }}</span>
            </div>
            <div class="tab-item" data-tab="invited">
                –ü—Ä–∏–≥–ª–∞—à–µ–Ω—ã <span class="tab-count">{{ students_by_status.invited|length }}</span>
            </div>
            <div class="tab-item" data-tab="rejected">
                –û—Ç–∫–∞–∑—ã <span class="tab-count">{{ students_by_status.rejected|length }}</span>
            </div>
        </div>

        <div class="tab-content">
            <form method="POST" class="applications-form">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <input type="hidden" name="action" value="bulk_update_status">

                <div class="bulk-actions">
                    <div class="bulk-controls">
                        <label class="select-all-label">
                            <input type="checkbox" id="select-all" onchange="toggleSelectAll()">
                            –í—ã–±—Ä–∞—Ç—å –≤—Å–µ
                        </label>
                        <div class="bulk-status-update">
                            <select name="status" id="bulk-status">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç—É—Å</option>
                                <option value="new">–ù–æ–≤–∞—è</option>
                                <option value="in_review">–í —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</option>
                                <option value="invited">–ü—Ä–∏–≥–ª–∞—à—ë–Ω</option>
                                <option value="rejected">–û—Ç–∫–∞–∑</option>
                            </select>
                            <button type="submit" class="btn-update-status" disabled id="update-status-btn">
                                –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
                            </button>
                        </div>
                    </div>
                </div>

                {% for status, students in students_by_status.items() %}
                <div class="tab-panel {% if status == 'new' %}active{% endif %}" id="tab-{{ status }}">
                    {% if students %}
                    <div class="students-list">
                        {% for student in students %}
                        <div class="student-item">
                            <div class="student-checkbox">
                                <input type="checkbox" name="student_ids" value="{{ student.id }}"
                                    class="student-checkbox-input" onchange="updateBulkButton()">
                            </div>

                            <div class="student-info">
                                <div class="student-header">
                                    <h3 class="student-name">{{ student.full_name }}</h3>
                                    <div class="student-status status-{{ student.status }}">
                                        {% if student.status == 'new' %}–ù–æ–≤–∞—è
                                        {% elif student.status == 'in_review' %}–í —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
                                        {% elif student.status == 'invited' %}–ü—Ä–∏–≥–ª–∞—à—ë–Ω
                                        {% elif student.status == 'rejected' %}–û—Ç–∫–∞–∑
                                        {% endif %}
                                    </div>
                                </div>

                                <div class="student-details">
                                    <div class="detail-row">
                                        <span class="detail-label">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</span>
                                        <span class="detail-value">{{ student.birth_date }}</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å:</span>
                                        <span class="detail-value">{{ student.speciality }}</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">–¢–µ–ª–µ—Ñ–æ–Ω:</span>
                                        <span class="detail-value">{{ student.phone }}</span>
                                    </div>
                                    {% if student.resume_link %}
                                    <div class="detail-row">
                                        <span class="detail-label">–†–µ–∑—é–º–µ:</span>
                                        <a href="{{ student.resume_link }}" target="_blank" class="detail-link">
                                            –°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–µ–∑—é–º–µ
                                        </a>
                                    </div>
                                    {% endif %}
                                    {% if student.resume_file %}
                                    <div class="detail-row">
                                        <span class="detail-label">–§–∞–π–ª —Ä–µ–∑—é–º–µ:</span>
                                        <a href="{{ url_for('panel.student_resume_file') }}?student_id={{ student.id }}&student_full_name={{ student.full_name }}"
                                            class="detail-link download-resume">
                                            –°–∫–∞—á–∞—Ç—å —Ä–µ–∑—é–º–µ
                                        </a>
                                    </div>
                                    {% endif %}
                                </div>

                                <div class="student-actions">
                                    <form method="POST" action="{{ url_for('panel.application_approve', application_id=student.id) }}" style="display: inline;">
                                        <input type="hidden" name="csrf_token" value="{{ csrf_token }}"/>
                                        <button type="submit" class="btn-approve" onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ–¥–æ–±—Ä–∏—Ç—å —ç—Ç—É –∑–∞—è–≤–∫—É?')">
                                            <span class="btn-icon">‚úÖ</span>
                                            –û–¥–æ–±—Ä–∏—Ç—å
                                        </button>
                                    </form>
                                    <form method="POST" action="{{ url_for('panel.application_reject', application_id=student.id) }}" style="display: inline;">
                                        <input type="hidden" name="csrf_token" value="{{ csrf_token }}"/>
                                        <button type="submit" class="btn-reject" onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–∫–ª–æ–Ω–∏—Ç—å —ç—Ç—É –∑–∞—è–≤–∫—É?')">
                                            <span class="btn-icon">‚ùå</span>
                                            –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                                        </button>
                                    </form>
                                    <form method="POST" action="{{ url_for('panel.application_delete', application_id=student.id) }}" style="display: inline;">
                                        <input type="hidden" name="csrf_token" value="{{ csrf_token }}"/>
                                        <button type="submit" class="btn-delete" onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞—è–≤–∫—É? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')">
                                            <span class="btn-icon">üóëÔ∏è</span>
                                            –£–¥–∞–ª–∏—Ç—å
                                        </button>
                                    </form>
                                    <button type="button" class="btn-change-status"
                                        onclick="showStatusModal({{ student.id }}, '{{ student.status }}')">
                                        –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å
                                    </button>
                                    <button type="button" class="btn-view-details"
                                        onclick="showStudentDetails({{ student.id }})">
                                        –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                    </button>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="empty-state">
                        <p>–ù–µ—Ç –∑–∞—è–≤–æ–∫ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º
                            {% if status == 'new' %}"–ù–æ–≤—ã–µ"
                            {% elif status == 'in_review' %}"–í —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏"
                            {% elif status == 'invited' %}"–ü—Ä–∏–≥–ª–∞—à–µ–Ω—ã"
                            {% elif status == 'rejected' %}"–û—Ç–∫–∞–∑—ã"
                            {% endif %}
                        </p>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </form>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ -->
<div id="status-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏</h3>
            <span class="close" onclick="closeStatusModal()">&times;</span>
        </div>
        <form method="POST" id="status-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            <input type="hidden" name="action" value="bulk_update_status">
            <input type="hidden" name="student_ids" id="modal-student-id">
            <div class="form-group">
                <label for="modal-status">–ù–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å:</label>
                <select name="status" id="modal-status" required>
                    <option value="new">–ù–æ–≤–∞—è</option>
                    <option value="in_review">–í —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</option>
                    <option value="invited">–ü—Ä–∏–≥–ª–∞—à—ë–Ω</option>
                    <option value="rejected">–û—Ç–∫–∞–∑</option>
                </select>
            </div>
            <div class="modal-actions">
                <button type="submit" class="btn-submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button type="button" class="btn-cancel" onclick="closeStatusModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </form>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π —Å—Ç—É–¥–µ–Ω—Ç–∞ -->
<div id="student-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>–î–µ—Ç–∞–ª–∏ –∑–∞—è–≤–∫–∏</h3>
            <span class="close" onclick="closeStudentModal()">&times;</span>
        </div>
        <div id="student-details-content">
            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/panel/vacancies/vacancy_applications.js') }}"></script>
{% endblock %}