{% extends "panel/base.html" %}

{% block title %}
–†—É–¥–Ω–µ–≤–æ - –ü–∞—Ä—Ç–Ω–µ—Ä—ã
{% endblock %}

{% block styles %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/panel/partners/partners_list.css') }}">
<style>
    .btn-remove-image {
        background: #f44336;
        color: #fff;
        border: none;
        border-radius: 6px;
        padding: 8px 18px;
        font-size: 15px;
        cursor: pointer;
        margin-top: 10px;
        transition: background 0.2s;
        display: inline-block;
    }

    .btn-remove-image:hover {
        background: #c62828;
    }
</style>
{% endblock %}

{% block container %}
<div class="partners-container">
    <div class="partners-header">
        <div class="header-content">
            <h1>–ü–∞—Ä—Ç–Ω–µ—Ä—ã</h1>
        </div>
        <button class="btn-create" onclick="createPartner()">
            <span class="btn-icon">+</span>
            –°–æ–∑–¥–∞—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞
        </button>
    </div>

    <div class="partners-stats">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">ü§ù</div>
                <div class="stat-content">
                    <div class="stat-number">{{ partners|length }}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-content">
                    <div class="stat-number">{{ partners|selectattr('is_active', 'equalto', True)|list|length }}</div>
                    <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üîí</div>
                <div class="stat-content">
                    <div class="stat-number">{{ partners|selectattr('is_active', 'equalto', False)|list|length }}</div>
                    <div class="stat-label">–°–∫—Ä—ã—Ç—ã—Ö</div>
                </div>
            </div>
        </div>
    </div>

    <div class="partners-list">
        {% for partner in partners %}
        <div class="partner-card {% if not partner.is_active %}hidden{% endif %}">
            <div class="partner-image">
                {% if partner.image_url %}
                <img src="{{ url_for('panel.partner_image', partner_id=partner.id) }}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–∞—Ä—Ç–Ω–µ—Ä–∞">
                {% else %}
                <div class="no-image">
                    <span>ü§ù</span>
                </div>
                {% endif %}
            </div>
            <div class="partner-content">
                <div class="partner-header-info">
                    <h3 class="partner-name">
                        <span>
                            {% if partner.name and partner.name|length > 50 %}
                            {{ partner.name[:50] }}...
                            {% else %}
                            {{ partner.name }}
                            {% endif %}
                        </span>
                    </h3>
                    <div class="partner-status">
                        {% if partner.is_active %}
                        <span class="status-visible">–ê–∫—Ç–∏–≤–µ–Ω</span>
                        {% else %}
                        <span class="status-hidden">–°–∫—Ä—ã—Ç</span>
                        {% endif %}
                    </div>
                </div>

                <div class="partner-meta">
                    <span class="partner-date">{{ partner.created_at }}</span>
                    <div class="partner-actions">
                        <button type="button" class="btn-edit" onclick="return editPartner({{ partner.id }})">
                            <span class="btn-icon">‚úèÔ∏è</span>
                            –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                        <form method="POST" action="{{ url_for('panel.partner_toggle_visibility', partner_id=partner.id) }}"
                            style="display: inline;">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
                            <button type="submit" class="btn-toggle"
                                onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞?')">
                                <span class="btn-icon">üëÅÔ∏è</span>
                                {% if partner.is_active %}–°–∫—Ä—ã—Ç—å{% else %}–ü–æ–∫–∞–∑–∞—Ç—å{% endif %}
                            </button>
                        </form>
                        <form method="POST" action="{{ url_for('panel.partner_delete', partner_id=partner.id) }}"
                            style="display: inline;">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
                            <button type="submit" class="btn-delete"
                                onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')">
                                <span class="btn-icon">üóëÔ∏è</span>
                                –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}

        {% if not partners %}
        <div class="no-partners">
            <div class="no-partners-icon">ü§ù</div>
            <div class="no-partners-text">–ü–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</div>
            <div class="no-partners-subtext">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞, –Ω–∞–∂–∞–≤ –∫–Ω–æ–ø–∫—É "–°–æ–∑–¥–∞—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞"</div>
        </div>
        {% endif %}
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞ -->
<div id="partnerModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle">–°–æ–∑–¥–∞—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞</h2>
            <span class="close" onclick="closePartnerModal()">&times;</span>
        </div>
        <form id="partnerForm" method="POST" action="{{ url_for('panel.partner_create') }}" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
            <div class="form-group">
                <label for="name">–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞ *</label>
                <input type="text" id="name" name="name" required>
            </div>

            <div class="form-group">
                <label for="image">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</label>
                <div id="imageBlock">
                    <img id="imagePreview" src="" alt="–ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è"
                        style="display:none;max-width:100%;margin-top:10px;" />
                    <button type="button" id="removeImageBtn" style="display:none;margin-top:10px;"
                        class="btn-remove-image">–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button>
                    <input type="file" id="image" name="image" accept="image/*" />
                </div>
            </div>
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="is_active" name="is_active" checked>
                    –ê–∫—Ç–∏–≤–µ–Ω
                </label>
            </div>
            <div class="form-actions">
                <button type="button" class="btn-cancel" onclick="closePartnerModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn-save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ url_for('static', filename='js/panel/partners/partners_list.js') }}"></script>
{% endblock %} 