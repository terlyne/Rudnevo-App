{% extends "panel/base.html" %}

{% block title %}
–†—É–¥–Ω–µ–≤–æ - –í–æ–ø—Ä–æ—Å—ã
{% endblock %}

{% block styles %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/panel/feedback/feedback_list.css') }}">
{% endblock %}

{% block container %}
<div class="feedback-container">
    <div class="feedback-header">
        <h1>–í–æ–ø—Ä–æ—Å—ã</h1>
        <div class="feedback-stats">
            <span class="stat-item">
                <span class="stat-number">{{ feedbacks|length }}</span>
                <span class="stat-label">–≤—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤</span>
            </span>
            <span class="stat-item">
                <span class="stat-number">{{ feedbacks|selectattr('response_text', 'none')|list|length }}</span>
                <span class="stat-label">–±–µ–∑ –æ—Ç–≤–µ—Ç–∞</span>
            </span>
        </div>
    </div>

    <div class="feedback-list">
        {% if feedbacks %}
        {% for feedback in feedbacks %}
        <div class="feedback-card {% if not feedback.response_text %}unanswered{% endif %}">
            <div class="feedback-header-info">
                <div class="feedback-meta">
                    <div class="feedback-author">
                        <span class="author-name">{{ feedback.name }}</span>
                        <span class="author-email">{{ feedback.email }}</span>
                    </div>
                    <div class="feedback-date">{{ feedback.created_at }}</div>
                </div>
                <div class="feedback-status">
                    {% if feedback.response_text %}
                    <span class="status-answered">–û—Ç–≤–µ—á–µ–Ω</span>
                    {% else %}
                    <span class="status-unanswered">–û–∂–∏–¥–∞–µ—Ç –æ—Ç–≤–µ—Ç–∞</span>
                    {% endif %}
                </div>
            </div>

            <div class="feedback-content">
                <div class="feedback-question">
                    <h3>–í–æ–ø—Ä–æ—Å:</h3>
                    <p>{{ feedback.message }}</p>
                </div>

                {% if feedback.response_text %}
                <div class="feedback-response">
                    <h3>–û—Ç–≤–µ—Ç:</h3>
                    <p>{{ feedback.response_text }}</p>
                    <div class="response-meta">
                        <span class="response-date">{{ feedback.updated_at }}</span>
                    </div>
                </div>
                {% endif %}
            </div>

            <div class="feedback-actions">
                {% if not feedback.response_text %}
                <form method="POST" action="{{ url_for('panel.feedback_respond', feedback_id=feedback.id) }}"
                    style="display: inline;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
                    <button type="submit" class="btn-respond" onclick="return respondToFeedback({{ feedback.id }})">
                        <span class="btn-icon">üí¨</span>
                        –û—Ç–≤–µ—Ç–∏—Ç—å
                    </button>
                </form>
                {% endif %}
                <form method="POST" action="{{ url_for('panel.feedback_delete', feedback_id=feedback.id) }}"
                    style="display: inline;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
                    <button type="submit" class="btn-delete"
                        onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')">
                        <span class="btn-icon">üóëÔ∏è</span>
                        –£–¥–∞–ª–∏—Ç—å
                    </button>
                </form>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="no-feedback">
            <div class="no-feedback-icon">‚ùì</div>
            <div class="no-feedback-text">–í–æ–ø—Ä–æ—Å–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</div>
            <div class="no-feedback-subtext">–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤–æ–ø—Ä–æ—Å—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
        </div>
        {% endif %}
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤–æ–ø—Ä–æ—Å -->
<div id="responseModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>–û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å</h2>
            <span class="close" onclick="closeResponseModal()">&times;</span>
        </div>
        <form id="responseForm" method="post">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
            <div class="form-group">
                <label for="response_text">–í–∞—à –æ—Ç–≤–µ—Ç *</label>
                <textarea id="response_text" name="response_text" rows="6" required
                    placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç..."></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn-cancel" onclick="closeResponseModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn-save">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ url_for('static', filename='js/panel/feedback/feedback_list.js') }}"></script>
{% endblock %}