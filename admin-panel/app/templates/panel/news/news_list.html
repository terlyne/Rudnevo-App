{% extends "panel/base.html" %}

{% block title %}
–†—É–¥–Ω–µ–≤–æ - –ù–æ–≤–æ—Å—Ç–∏
{% endblock %}

{% block styles %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/panel/news/news_list.css') }}">
<style>
.btn-remove-image {
    background: #f44336;
    color: #fff;
    border: none;
    border-radius: 6px;
    padding: 8px 18px;
    font-size: 15px;
    cursor: pointer;
    margin-top: 10px;
    transition: background 0.2s;
    display: inline-block;
}
.btn-remove-image:hover {
    background: #c62828;
}
</style>
{% endblock %}

{% block container %}
<div class="news-container" data-is-superuser="{{ 'true' if current_user.is_superuser else 'false' }}">
    <div class="news-header">
        <div class="header-content">
            <h1>–ù–æ–≤–æ—Å—Ç–∏</h1>
            <p class="header-subtitle">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –Ω–æ–≤–æ—Å—Ç—å, –Ω–∞–∂–∞–≤ –∫–Ω–æ–ø–∫—É "–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å"</p>
        </div>
        <button class="btn-create" onclick="createNews()">
            <span class="btn-icon">+</span>
            –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å
        </button>
    </div>

    <div class="news-stats">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üì∞</div>
                <div class="stat-content">
                    <div class="stat-number">{{ news|length }}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –Ω–æ–≤–æ—Å—Ç–µ–π</div>
                </div>
            </div>
            {% if current_user.is_superuser %}
            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-content">
                    <div class="stat-number">{{ news|selectattr('is_hidden', 'equalto', False)|list|length }}</div>
                    <div class="stat-label">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üôà</div>
                <div class="stat-content">
                    <div class="stat-number">{{ news|selectattr('is_hidden', 'equalto', True)|list|length }}</div>
                    <div class="stat-label">–°–∫—Ä—ã—Ç—ã—Ö</div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="news-filters">
        <label class="filter-checkbox">
            <input type="checkbox" id="showHidden" onchange="toggleHiddenNews()">
            <span class="checkmark"></span>
            –ü–æ–∫–∞–∑–∞—Ç—å —Å–∫—Ä—ã—Ç—ã–µ –Ω–æ–≤–æ—Å—Ç–∏
        </label>
    </div>

    <div class="news-list">
        {% if news %}
            {% for news_item in news %}
            <div class="news-card {% if news_item.is_hidden %}hidden{% endif %}">
                <div class="news-image">
                    {% if news_item.image_url %}
                        <img src="{{ url_for('panel.news_image', news_id=news_item.id) }}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏">
                    {% else %}
                        <div class="no-image">
                            <span>üì∞</span>
                        </div>
                    {% endif %}
                </div>
                <div class="news-content">
                    <div class="news-header-info">
                        <h3 class="news-title">
                            <span>
                            {% if news_item.title and news_item.title|length > 50 %}
                                {{ news_item.title[:50] }}...
                            {% else %}
                                {{ news_item.title }}
                            {% endif %}
                            </span>
                        </h3>
                        <div class="news-status">
                            {% if news_item.is_hidden %}
                                <span class="status-hidden">–°–∫—Ä—ã—Ç–∞</span>
                            {% else %}
                                <span class="status-visible">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="news-excerpt">
                        <span>
                        {% if news_item.content and news_item.content|length > 50 %}
                            {{ news_item.content[:50] }}...
                        {% else %}
                            {{ news_item.content }}
                        {% endif %}
                        </span>
                    </div>
                    <div class="news-meta">
                        <span class="news-date">{{ news_item.created_at }}</span>
                        <div class="news-actions">
                            <button type="button" class="btn-edit" onclick="return editNews({{ news_item.id }})">
                                <span class="btn-icon">‚úèÔ∏è</span>
                                –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                            <form method="POST" action="{{ url_for('panel.news_toggle_visibility', news_id=news_item.id) }}" style="display: inline;">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token }}"/>
                                <input type="hidden" name="show_hidden" value="{% if request.args.get('show_hidden') == 'true' %}true{% else %}false{% endif %}"/>
                                <button type="submit" class="btn-toggle" onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å –Ω–æ–≤–æ—Å—Ç–∏?')">
                                    <span class="btn-icon">üëÅÔ∏è</span>
                                    {% if news_item.is_hidden %}–ü–æ–∫–∞–∑–∞—Ç—å{% else %}–°–∫—Ä—ã—Ç—å{% endif %}
                                </button>
                            </form>
                            <form method="POST" action="{{ url_for('panel.news_delete', news_id=news_item.id) }}" style="display: inline;">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token }}"/>
                                <button type="submit" class="btn-delete" onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –Ω–æ–≤–æ—Å—Ç—å? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')">
                                    <span class="btn-icon">üóëÔ∏è</span>
                                    –£–¥–∞–ª–∏—Ç—å
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="no-news">
                <div class="no-news-icon">üì∞</div>
                <div class="no-news-text">–ù–æ–≤–æ—Å—Ç–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</div>
                <div class="no-news-subtext">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –Ω–æ–≤–æ—Å—Ç—å, –Ω–∞–∂–∞–≤ –∫–Ω–æ–ø–∫—É "–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å"</div>
            </div>
        {% endif %}
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–∏ -->
<div id="newsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å</h2>
            <span class="close" onclick="closeNewsModal()">&times;</span>
        </div>
        <form id="newsForm" method="POST" action="{{ url_for('panel.news_create') }}" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}"/>
            <div class="form-group">
                <label for="title">–ó–∞–≥–æ–ª–æ–≤–æ–∫ *</label>
                <input type="text" id="title" name="title" required>
            </div>
            <div class="form-group">
                <label for="content">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ *</label>
                <textarea id="content" name="content" rows="8" required></textarea>
            </div>
            <div class="form-group">
                <label for="image">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</label>
                <div id="imageBlock">
                    <img id="imagePreview" src="" alt="–ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è" style="display:none;max-width:100%;margin-top:10px;" />
                    <button type="button" id="removeImageBtn" style="display:none;margin-top:10px;" class="btn-remove-image">–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button>
                    <input type="file" id="image" name="image" accept="image/*" style="display:block;" />
                </div>
            </div>
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="is_hidden" name="is_hidden">
                    <span class="checkmark"></span>
                    –°–∫—Ä—ã—Ç—å –Ω–æ–≤–æ—Å—Ç—å
                </label>
            </div>
            <div class="form-actions">
                <button type="button" class="btn-cancel" onclick="closeNewsModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn-save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ url_for('static', filename='js/panel/news/news_list.js') }}"></script>
{% endblock %}